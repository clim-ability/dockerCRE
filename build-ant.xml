<?xml version="1.0" encoding="UTF-8"?>
<project name="dockerCRE" default="build-new">


     <target name="build-new" depends="init, copyReplace"/>


     <target name="clone" description="Clones Repository for CRE environment from github (to remember only)">
       <exec dir="/data" executable="git">
          <srg line="clone https://github.com/tambora-org/dockerCRE.git"/>
       </exec>
    </target>
  

    <target name="init" description="Initialize environment">
        <property environment="env"/>
       
 
        <condition property="cre-domain" value="${env.CRE_DOMAIN}" else="example.com">
            <isset property="env.CRE_DOMAIN" /> 
        </condition>

        <condition property="cre-username" value="${env.CRE_USERNAME}" else="username">
            <isset property="env.CRE_USERNAME" />
        </condition>
        <condition property="cre-password" value="${env.CRE_PASSWORD}" else="password">
            <isset property="env.CRE_PASSWORD" />
        </condition>
        <condition property="cre-dbname" value="${env.CRE_DBNAME}" else="dbname">
            <isset property="env.CRE_DBNAME" />
        </condition>

    </target>


    <target name="copyReplace" description="Copy template files and replace some strings">
         <copy file="proxy/nginx.conf.template" tofile="proxy/nginx.conf" overwrite="true" />
         <replace file="proxy/nginx.conf" token="example.com" value="${cre-domain}"/>

         <copy file="nextcloud/config/config.php.template" tofile="nextcloud/config/autoconfig.php" overwrite="true" />
         <replace file="nextcloud/config/autoconfig.php" token="example.com" value="${cre-domain}"/>
         <replace file="nextcloud/config/autoconfig.php" token="klingaman" value="${cre-username}"/>
         <replace file="nextcloud/config/autoconfig.php" token="pinatubo" value="${cre-password}"/>
         <replace file="nextcloud/config/autoconfig.php" token="sumatra" value="${cre-dbname}"/>

         <copy file="docker-compose.yml.template" tofile="docker-compose.yml" overwrite="true" />
         <replace file="docker-compose.yml" token="klingaman" value="${cre-username}"/>
         <replace file="docker-compose.yml" token="pinatubo" value="${cre-password}"/>
         <replace file="docker-compose.yml" token="sumatra" value="${cre-dbname}"/>

    </target>




</project>
